<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Jamble Demo</title>
    <link rel="stylesheet" href="./dist/jamble.css" />
  </head>
  <body>
    <h1 style="text-align:center;font-family:system-ui,sans-serif">Jamble Demo</h1>
    <div id="jamble">
      <div class="jamble-game">
        <div class="jamble-player jamble-player-idle"></div>
        <div class="jamble-tree" data-tree="1" style="left: 35%"></div>
        <div class="jamble-tree" data-tree="2" style="left: 65%"></div>
        <div class="jamble-level">0</div>
        <div class="jamble-countdown">3</div>
        <button class="jamble-reset" title="Reset">↻</button>
      </div>
      <div class="jamble-controls">
        <button class="jamble-start" title="Start">▶</button>
        <button class="jamble-shuffle" title="Shuffle">⇄</button>
      </div>
    </div>

    <!-- Minimal Debug Panel -->
    <div id="jamble-debug" style="position:fixed;left:50%;bottom:12px;transform:translateX(-50%);width:calc(100% - 24px);max-width:500px;font-family:system-ui,sans-serif;z-index:1000">
      <details open>
        <summary>Debug</summary>
        <div style="display:grid;grid-template-columns:1fr auto;gap:6px;align-items:center;margin-top:8px">
          <label for="dbg-jump">Jump strength</label>
          <input id="dbg-jump" type="number" step="0.1" min="1" max="30" style="width:100px">
          <label for="dbg-speed">Player speed</label>
          <input id="dbg-speed" type="number" step="1" min="10" max="600" style="width:100px">
          <label for="dbg-mode">Ping-pong mode</label>
          <input id="dbg-mode" type="checkbox" style="width:auto">
          <label for="dbg-squash">Squash animation</label>
          <input id="dbg-squash" type="checkbox" style="width:auto">
        </div>
      </details>
    </div>

    <script src="./dist/jamble.js"></script>
    <script>
      (function(){
        if (!window.Jamble || !window.Jamble.Game) return;
        var root = document.getElementById('jamble');
        var game = new window.Jamble.Game(root);
        game.start();

        // Debug bindings
        var jumpEl = document.getElementById('dbg-jump');
        var speedEl = document.getElementById('dbg-speed');
        var modeEl = document.getElementById('dbg-mode');
        var squashEl = document.getElementById('dbg-squash');

        function clamp(n, min, max){ n = Number(n); if (Number.isNaN(n)) return min; return Math.max(min, Math.min(max, n)); }
        function syncFromSettings(){
          var s = window.Jamble.Settings.current;
          if (jumpEl) jumpEl.value = String(s.jumpStrength);
          if (speedEl) speedEl.value = String(s.playerSpeed);
          if (modeEl) modeEl.checked = (s.mode === 'pingpong');
          if (squashEl) squashEl.checked = !!s.squashEnabled;
        }
        function onInput(){
          var j = jumpEl ? clamp(jumpEl.value, 1, 30) : undefined;
          var p = speedEl ? clamp(speedEl.value, 10, 600) : undefined;
          var patch = {};
          if (j !== undefined) patch.jumpStrength = Number(j);
          if (p !== undefined) patch.playerSpeed = Number(p);
          if (modeEl) patch.mode = modeEl.checked ? 'pingpong' : 'idle';
          if (squashEl) patch.squashEnabled = !!squashEl.checked;
          window.Jamble.Settings.update(patch);
        }
        if (jumpEl) jumpEl.addEventListener('input', onInput);
        if (speedEl) speedEl.addEventListener('input', onInput);
        if (modeEl) modeEl.addEventListener('change', onInput);
        if (squashEl) squashEl.addEventListener('change', onInput);

        // Prevent debug interactions from triggering game pointer handler
        var dbg = document.getElementById('jamble-debug');
        if (dbg){
          dbg.addEventListener('pointerdown', function(ev){ ev.stopPropagation(); });
          dbg.addEventListener('click', function(ev){ ev.stopPropagation(); });
        }

        // Initial sync and after settings load (HTTP mode)
        syncFromSettings();
        window.addEventListener('jamble:settingsLoaded', syncFromSettings);
      })();
    </script>
  </body>
  </html>
